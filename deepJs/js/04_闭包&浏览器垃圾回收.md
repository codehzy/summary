## 闭包
```JS
function fn() {
    var x = 100;
    return function () {
        console.log('codehzy')
    }
}
var f = fn();
f();
```
### 闭包特性
![](./assets/03_函数的底层处理机制/closure.png)
函数执行，会形成一个私有的上下文
+ 里面的私有变量，受到私有上下文的“保护”，不受外接干扰。
+ 有可能形成不被释放的上下文，里面的私有变量和一些值，就会被“保存”起来，这些值供其“下级”上下文中调取使用。
+ 我们把函数这种“保存/保护”机制，称之为“闭包”！！
### 浏览器垃圾回收
- GC： 浏览器的垃圾回收机制（内存释放）「栈内存释放」
  - 加载页面，形成一个全局的上下文，只有页面关闭后，全局上下文才会被释放。
  - 函数执行会形成一个私有的上下文，进栈执行；当函数中代码执行完成，大部分情况下，形成的上下文都会被出栈释放掉，以此优化栈内存大小
    - 堆内存释放
      - 方法一（chrome）： **查找引用**
        - 浏览器在空闲或者指定时间内，查看所有的堆内存，把没有被任何东西占用的堆内存释放掉；但是占用着的是不被释放的。
      - 方法二（IE）：**引用计数**
        - 创建一个堆内存，被占用一次，则浏览器计数+1，取消占用则计数-1，当记录的数字为0的时候，则内存释放掉； -> 某些情况会导致计数混乱出现“内存泄漏”的现象，可参考高程4
![浏览器垃圾清除](assets/03_函数的底层处理机制/2.png)